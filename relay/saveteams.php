<?phprequire_once('/home/bigfooto/public_html/relay/mysqli_connect.php');require_once('/home/bigfooto/public_html/relay/trace.php');$DEBUGME = true;$class = $_REQUEST['class'];$teamCount = $_REQUEST['teamCount'];$oldTeams = $_REQUEST['oldTeams'];$inError = false;$query = "begin work";$result = $mysqli->query($query);if (!$result)	echo($mysqli->error);else {	if ($result && strlen($oldTeams) > 0) {		$query = "delete from teammember where teamid in ($oldTeams)";		Trace($query);		$result = $mysqli->query($query);		if (!$result)			echo($mysqli->error);	}	if ($result  && strlen($oldTeams) > 0) {		$query = "delete from team where id in ($oldTeams)";		Trace($query);		$result = $mysqli->query($query);		if (!$result)			echo($mysqli->error);		}	if ($result) {		$i = 1;		while ($i <= $teamCount && $result) {			$detail = $_REQUEST["team".$i];			Trace("details is $detail");			$parts = split(",", $detail);			$query = "insert into team(class,name) values('$class','".$parts[0]."')";			Trace($query);			$result = $mysqli->query($query);			if (!$result)				echo($mysqli->error);			else {				$query = "select id from team where class = '$class' and name = '".$parts[0]."'";				Trace($query);				$result = $mysqli->query($query);				if (!$result)					echo($mysqli->error);				else {					$id = $result->fetch_assoc()['id'];					$j = 1;					while ($result && $j < sizeof($parts)) {						$query = "insert into teammember (teamid, entryid, runningorder) values($id,".$parts[$j].", $j)";						Trace($query);						$result = $mysqli->query($query);						if (!$result)							echo($mysqli->error);						else							++$j;						}					}				}				$i++;			}		}	}if ($result) {	$query = "commit work";	Trace($query);	$result = $mysqli->query($query);	if ($result)		echo("Teams saved");	}else {	$query = "rollback work";	Trace($query);	$result = $mysqli->query($query);}?>